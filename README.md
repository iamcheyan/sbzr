# Rime è¾“å…¥æ³•é…ç½®

## ğŸ“‹ ç›®å½•

- [è¾“å…¥æ–¹æ¡ˆ](#è¾“å…¥æ–¹æ¡ˆ)
- [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
- [å®‰è£…æ–¹æ³•](#å®‰è£…æ–¹æ³•)
- [æ¢å¤æ–¹æ³•](#æ¢å¤æ–¹æ³•)
- [build/ å’Œ userdb/ çš„å…³ç³»](#build-å’Œ-userdb-çš„å…³ç³»)
- [ç”¨æˆ·æ•°æ®è¯´æ˜](#ç”¨æˆ·æ•°æ®è¯´æ˜)
- [å†…å­˜é—®é¢˜è¯´æ˜](#å†…å­˜é—®é¢˜è¯´æ˜)
- [Git åŒæ­¥è¯´æ˜](#git-åŒæ­¥è¯´æ˜)
- [æ³¨æ„äº‹é¡¹](#æ³¨æ„äº‹é¡¹)

---

## è¾“å…¥æ–¹æ¡ˆ

- **å£°ç¬”è‡ªç„¶ (sbzr)**ï¼šåŸºäºå£°ç¬”ç¼–ç çš„ä¸­æ–‡è¾“å…¥æ³•

## é…ç½®è¯´æ˜

### ä¸»è¦æ–‡ä»¶

- `default.custom.yaml` - é»˜è®¤é…ç½®è‡ªå®šä¹‰
- `sbzr.schema.yaml` - å£°ç¬”è‡ªç„¶è¾“å…¥æ–¹æ¡ˆ
- `sbzr.custom.yaml` - å£°ç¬”è‡ªç„¶è‡ªå®šä¹‰é…ç½®
- `key_bindings.yaml` - æŒ‰é”®ç»‘å®šé…ç½®
- `key_bindings.custom.yaml` - æŒ‰é”®ç»‘å®šè‡ªå®šä¹‰

### ä¾èµ–æ–‡ä»¶

- `sbxlm.yaml` - å£°ç¬”ç³»åˆ—å…±ç”¨é…ç½®
- `sbyp.*` - æ‹¼éŸ³åæŸ¥
- `sbpy.*` - æ‹¼éŸ³è¯å…¸
- `lua/` - Lua è„šæœ¬
- `opencc/` - ç®€ç¹è½¬æ¢é…ç½®

## å®‰è£…æ–¹æ³•

1. å°†é…ç½®æ–‡ä»¶å¤åˆ¶åˆ° Rime é…ç½®ç›®å½•ï¼š
   ```bash
   # Linux (fcitx5)
   cp -r * ~/.local/share/fcitx5/rime/
   
   # macOS (Squirrel)
   cp -r * ~/Library/Rime/
   
   # Windows (Weasel)
   cp -r * %APPDATA%\Rime\
   ```

2. é‡æ–°éƒ¨ç½²é…ç½®ï¼š
   ```bash
   rime_deployer --build
   ```

## æ¢å¤æ–¹æ³•

```bash
# è§£å‹å¤‡ä»½
cd ~/.local/share/fcitx5/rime
tar -xzf rime_config_backup_*.tar.gz

# é‡æ–°ç¼–è¯‘
rime_deployer --build
```

---

## build/ å’Œ userdb/ çš„å…³ç³»

### æ¦‚è¿°

`build/` å’Œ `sbzr.userdb/` æ˜¯ä¸¤ä¸ª**ç‹¬ç«‹ä½†äº’è¡¥**çš„ç›®å½•ï¼Œå®ƒä»¬æœåŠ¡äºè¾“å…¥æ³•çš„ä¸åŒæ–¹é¢ã€‚

### build/ ç›®å½•ï¼ˆç¼–è¯‘è¾“å‡ºï¼‰

**ä½œç”¨ï¼š**
- **ç¼–è¯‘æ—¶ç”Ÿæˆ**ï¼šç”± `rime_deployer` ç¼–è¯‘ç”Ÿæˆ
- **ç³»ç»Ÿè¯å…¸**ï¼šåŒ…å«è¾“å…¥æ–¹æ¡ˆçš„åŸºç¡€è¯å…¸æ•°æ®
- **å¯é‡æ–°ç”Ÿæˆ**ï¼šåˆ é™¤åå¯ä»¥é‡æ–°ç¼–è¯‘æ¢å¤

**å†…å®¹ï¼š**
```
build/sbzr.prism.bin      (125K)  - è¯å…¸ç´¢å¼•ï¼ˆå¿«é€ŸæŸ¥æ‰¾ï¼‰
build/sbzr.table.bin      (108K)  - è¯è¡¨æ•°æ®ï¼ˆåŸºç¡€è¯æ±‡ï¼‰
build/sbzr.reverse.bin    (39K)   - åæŸ¥è¯å…¸ï¼ˆåå‘æŸ¥æ‰¾ï¼‰
build/sbzr.schema.yaml    (11K)   - åˆå¹¶åçš„é…ç½®
```

**æ•°æ®æ¥æºï¼š**
- ä» `sbzr.dict.yaml`ï¼ˆæ–‡æœ¬è¯å…¸ï¼‰ç¼–è¯‘è€Œæ¥
- åŒ…å«è¾“å…¥æ–¹æ¡ˆçš„åŸºç¡€è¯æ±‡
- **æ‰€æœ‰ç”¨æˆ·å…±äº«**çš„åŸºç¡€æ•°æ®

**ç‰¹ç‚¹ï¼š**
- âœ… å¯ä»¥åˆ é™¤é‡å»º
- âœ… å¯ä»¥ç‰ˆæœ¬æ§åˆ¶ï¼ˆæºæ–‡ä»¶æ˜¯æ–‡æœ¬ï¼‰
- âœ… ä¸åŒ…å«ä¸ªäººæ•°æ®
- âŒ ä¸åŒ…å«ç”¨æˆ·å­¦ä¹ æ•°æ®

### sbzr.userdb/ ç›®å½•ï¼ˆç”¨æˆ·è¯å…¸ï¼‰

**ä½œç”¨ï¼š**
- **è¿è¡Œæ—¶ç”Ÿæˆ**ï¼šåœ¨ä½¿ç”¨è¾“å…¥æ³•æ—¶è‡ªåŠ¨åˆ›å»ºå’Œæ›´æ–°
- **ä¸ªäººè¯å…¸**ï¼šåŒ…å«ä½ çš„ä¸ªäººå­¦ä¹ æ•°æ®å’Œè‡ªå®šä¹‰è¯æ±‡
- **ä¸å¯é‡æ–°ç”Ÿæˆ**ï¼šåˆ é™¤åä¸ªäººæ•°æ®ä¼šä¸¢å¤±

**å†…å®¹ï¼š**
```
sbzr.userdb/031930.ldb    (2.1M)  - LevelDB æ•°æ®åº“æ–‡ä»¶
sbzr.userdb/031931.ldb    (1.4M)  - LevelDB æ•°æ®åº“æ–‡ä»¶
...ï¼ˆå¤šä¸ª .ldb æ–‡ä»¶ï¼Œæ€»è®¡çº¦ 9.4MBï¼‰
```

**æ•°æ®æ¥æºï¼š**
- ä½ è¾“å…¥è¿‡çš„è¯æ±‡è®°å½•
- è¯é¢‘ç»Ÿè®¡ï¼ˆå“ªäº›è¯ä½ ç”¨å¾—æ›´å¤šï¼‰
- è‡ªå®šä¹‰è¯æ±‡ï¼ˆä½ æ‰‹åŠ¨æ·»åŠ çš„è¯æ¡ï¼‰
- **ä¸ªäººç‹¬æœ‰**çš„å­¦ä¹ æ•°æ®

**ç‰¹ç‚¹ï¼š**
- âŒ åˆ é™¤åæ— æ³•æ¢å¤ï¼ˆé™¤éæœ‰å¤‡ä»½ï¼‰
- âŒ äºŒè¿›åˆ¶æ ¼å¼ï¼Œæ— æ³•ç›´æ¥ç¼–è¾‘
- âœ… åŒ…å«ä¸ªäººå­¦ä¹ æ•°æ®
- âœ… åŒ…å«è‡ªå®šä¹‰è¯æ±‡

### ä¸¤è€…çš„å…³ç³»

**å·¥ä½œæµç¨‹ï¼š**
```
1. ç¼–è¯‘é˜¶æ®µï¼ˆbuild/ï¼‰
   sbzr.dict.yaml (æ–‡æœ¬) 
   â†’ rime_deployer ç¼–è¯‘
   â†’ build/sbzr.*.bin (äºŒè¿›åˆ¶è¯å…¸)
   
2. è¿è¡Œé˜¶æ®µï¼ˆuserdb/ï¼‰
   ä½¿ç”¨è¾“å…¥æ³•
   â†’ å­¦ä¹ ä½ çš„è¾“å…¥ä¹ æƒ¯
   â†’ ä¿å­˜åˆ° sbzr.userdb/ (LevelDB)
   
3. æŸ¥æ‰¾é˜¶æ®µ
   Rime åŒæ—¶ä½¿ç”¨ï¼š
   - build/sbzr.table.bin (åŸºç¡€è¯å…¸)
   - sbzr.userdb/ (ä¸ªäººè¯å…¸)
   â†’ åˆå¹¶æ˜¾ç¤ºå€™é€‰è¯
```

**æ•°æ®å±‚æ¬¡ï¼š**
```
ä¸ªäººå±‚ï¼ˆuserdb/ï¼‰ï¼š
â”œâ”€â”€ å­¦ä¹ æ•°æ®ï¼ˆä½ çš„è¾“å…¥ä¹ æƒ¯ï¼‰
â”œâ”€â”€ è¯é¢‘ç»Ÿè®¡ï¼ˆå¸¸ç”¨è¯æ’åºï¼‰
â””â”€â”€ è‡ªå®šä¹‰è¯æ±‡ï¼ˆä½ æ·»åŠ çš„è¯ï¼‰
         â†‘ å åŠ 
åŸºç¡€å±‚ï¼ˆbuild/ï¼‰ï¼š
â”œâ”€â”€ ç³»ç»Ÿè¯å…¸ï¼ˆæ‰€æœ‰äººå…±äº«ï¼‰
â””â”€â”€ åŸºç¡€è¯æ±‡ï¼ˆä» dict.yaml ç¼–è¯‘ï¼‰
```

**äº’è¡¥å…³ç³»ï¼š**
- **build/** æä¾›åŸºç¡€è¯æ±‡ï¼ˆæ‰€æœ‰äººéƒ½æœ‰ï¼‰
- **userdb/** æä¾›ä¸ªäººä¼˜åŒ–ï¼ˆåªæœ‰ä½ æœ‰ï¼‰
- **ä¸¤è€…ç»“åˆ** = å®Œæ•´çš„è¾“å…¥ä½“éªŒ

### æ€»ç»“å¯¹æ¯”

| ç‰¹æ€§ | build/ | sbzr.userdb/ |
|------|--------|--------------|
| **ç”Ÿæˆæ—¶æœº** | ç¼–è¯‘æ—¶ | è¿è¡Œæ—¶ |
| **æ•°æ®æ¥æº** | dict.yaml | ç”¨æˆ·è¾“å…¥ |
| **å¯åˆ é™¤é‡å»º** | âœ… æ˜¯ | âŒ å¦ |
| **åŒ…å«ä¸ªäººæ•°æ®** | âŒ å¦ | âœ… æ˜¯ |
| **æ–‡ä»¶æ ¼å¼** | äºŒè¿›åˆ¶ï¼ˆ.binï¼‰ | LevelDBï¼ˆ.ldbï¼‰ |
| **å¤§å°** | ~280K | ~9.4MB |
| **ç‰ˆæœ¬æ§åˆ¶** | æºæ–‡ä»¶å¯æ§åˆ¶ | äºŒè¿›åˆ¶ï¼Œéš¾æ§åˆ¶ |
| **ç”¨é€”** | åŸºç¡€è¯å…¸ | ä¸ªäººå­¦ä¹  |

---

## ç”¨æˆ·æ•°æ®è¯´æ˜

### ä»€ä¹ˆæ˜¯ç”¨æˆ·æ•°æ®ï¼ˆ*.userdb/ï¼‰

`*.userdb/` ç›®å½•åŒ…å«çš„æ˜¯ **LevelDB æ•°æ®åº“æ–‡ä»¶**ï¼Œè¿™äº›æ˜¯äºŒè¿›åˆ¶æ ¼å¼çš„æ•°æ®ï¼ŒåŒ…æ‹¬ï¼š

1. **è‡ªåŠ¨å­¦ä¹ æ•°æ®**ï¼š
   - ä½ è¾“å…¥è¿‡çš„è¯æ±‡
   - è¯é¢‘ç»Ÿè®¡ï¼ˆå“ªäº›è¯ä½ ç”¨å¾—æ›´å¤šï¼‰
   - è¾“å…¥ä¹ æƒ¯è®°å½•

2. **è‡ªå®šä¹‰è¯æ±‡**ï¼š
   - é€šè¿‡è¾“å…¥æ³•æ·»åŠ çš„è‡ªå®šä¹‰è¯æ¡
   - è¯æ¡ä¸ç¼–ç çš„å¯¹åº”å…³ç³»

3. **æ•°æ®æ ¼å¼**ï¼š
   - äºŒè¿›åˆ¶ LevelDB æ ¼å¼ï¼ˆ`.ldb` æ–‡ä»¶ï¼‰
   - æ— æ³•ç›´æ¥ç¼–è¾‘
   - å¤§å°ï¼šçº¦ 9.4MBï¼ˆsbzr.userdbï¼‰

### åŒæ­¥é€‰é¡¹

**é€‰é¡¹ 1ï¼šä¸åŒæ­¥ userdbï¼ˆé»˜è®¤ï¼‰**

ä¼˜ç‚¹ï¼š
- ä»“åº“ä½“ç§¯å°
- æ¯ä¸ªè®¾å¤‡å¯ä»¥æœ‰è‡ªå·±çš„å­¦ä¹ æ•°æ®
- é¿å…å†²çª

ç¼ºç‚¹ï¼š
- æ–°è®¾å¤‡éœ€è¦é‡æ–°å­¦ä¹ 
- è‡ªå®šä¹‰è¯æ±‡ä¸ä¼šåŒæ­¥

**é€‰é¡¹ 2ï¼šåŒæ­¥ userdbï¼ˆå·²å¯ç”¨ï¼‰**

å¦‚æœä½ æƒ³åŒæ­¥è‡ªå®šä¹‰è¯åº“ï¼Œ`.gitignore` ä¸­å·²å–æ¶ˆå¯¹ `*.userdb/` çš„å¿½ç•¥ã€‚

ä¼˜ç‚¹ï¼š
- è‡ªå®šä¹‰è¯æ±‡ä¼šåŒæ­¥
- å­¦ä¹ æ•°æ®ä¼šåŒæ­¥
- å¤šè®¾å¤‡ä¿æŒä¸€è‡´

ç¼ºç‚¹ï¼š
- ä»“åº“ä½“ç§¯å¢åŠ çº¦ 9.4MB
- äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ— æ³•æŸ¥çœ‹å·®å¼‚
- å¤šè®¾å¤‡åŒæ—¶ç¼–è¾‘å¯èƒ½å†²çª

### å¦‚ä½•å¯¼å‡º userdb ä¸ºæ–‡æœ¬

```bash
# ä½¿ç”¨ rime_dict_manager å¯¼å‡ºï¼ˆå¦‚æœå¯ç”¨ï¼‰
rime_dict_manager -e sbzr > sbzr.userdb.txt

# æˆ–è€…æ‰‹åŠ¨ä» userdb ä¸­æå–è‡ªå®šä¹‰è¯æ±‡
```

---

## å†…å­˜é—®é¢˜è¯´æ˜

### é—®é¢˜åŸå› 

ç³»ç»Ÿå†…å­˜åªæœ‰ 1.9GBï¼Œä¸”æ²¡æœ‰äº¤æ¢ç©ºé—´ï¼ˆSwapï¼‰ã€‚`jaroomaji` æ—¥è¯­è¾“å…¥æ³•çš„è¯å…¸éå¸¸å¤§ï¼š
- è¯å…¸æ–‡ä»¶ï¼š225 ä¸‡è¡Œ
- ç¼–è¯‘åå¤§å°ï¼š138MB
- åŠ è½½åˆ°å†…å­˜ï¼šçº¦ 1GB

å½“ fcitx5 åŠ è½½ `jaroomaji` è¯å…¸æ—¶ï¼Œå†…å­˜å ç”¨è¶…è¿‡ç³»ç»Ÿå¯ç”¨å†…å­˜ï¼Œå¯¼è‡´è¢« OOM killer æ€æ­»ã€‚

### è§£å†³æ–¹æ¡ˆ

**æ–¹æ¡ˆ 1ï¼šæš‚æ—¶ç¦ç”¨ jaroomajiï¼ˆå·²å®æ–½ï¼‰**

å·²ä» `default.custom.yaml` ä¸­æ³¨é‡Šæ‰ `jaroomaji`ï¼Œç°åœ¨åªä½¿ç”¨ `sbzr` è¾“å…¥æ³•ã€‚

**æ¢å¤ jaroomaji çš„æ–¹æ³•ï¼š**
ç¼–è¾‘ `default.custom.yaml`ï¼Œå–æ¶ˆæ³¨é‡Šï¼š
```yaml
schema_list:
  - schema: sbzr
  - schema: jaroomaji  # å–æ¶ˆæ³¨é‡Šä»¥å¯ç”¨
```

**æ–¹æ¡ˆ 2ï¼šå‡å°‘ jaroomaji è¯å…¸å¤§å°**

å¯ä»¥åªä½¿ç”¨éƒ¨åˆ†è¯å…¸æ–‡ä»¶ï¼Œè€Œä¸æ˜¯å…¨éƒ¨åŠ è½½ï¼š
- åªä½¿ç”¨ `jaroomaji.dict.yaml`ï¼ˆä¸»è¯å…¸ï¼‰
- ç§»é™¤æˆ–æ³¨é‡Šæ‰å…¶ä»–å¤§å‹è¯å…¸ï¼š
  - `jaroomaji.jmdict.dict.yaml`
  - `jaroomaji.kanjidic2.dict.yaml`
  - `jaroomaji.mozc.dict.yaml`

**æ–¹æ¡ˆ 3ï¼šæ·»åŠ äº¤æ¢ç©ºé—´ï¼ˆæ¨èï¼‰**

ä¸ºç³»ç»Ÿæ·»åŠ äº¤æ¢ç©ºé—´å¯ä»¥é¿å… OOM é—®é¢˜ï¼š

```bash
# åˆ›å»º 2GB äº¤æ¢æ–‡ä»¶
sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile

# æ°¸ä¹…å¯ç”¨ï¼ˆæ·»åŠ åˆ° /etc/fstabï¼‰
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab
```

**æ–¹æ¡ˆ 4ï¼šä¼˜åŒ– jaroomaji é…ç½®**

åœ¨ `jaroomaji.custom.yaml` ä¸­ç¦ç”¨ä¸€äº›åŠŸèƒ½ä»¥å‡å°‘å†…å­˜å ç”¨ï¼š
```yaml
patch:
  translator:
    enable_completion: false
    enable_sentence: false
```

### å½“å‰çŠ¶æ€

- âœ… `sbzr` è¾“å…¥æ³•ï¼šæ­£å¸¸ä½¿ç”¨
- âŒ `jaroomaji` è¾“å…¥æ³•ï¼šå·²ç¦ç”¨ï¼ˆå†…å­˜ä¸è¶³ï¼‰

### é‡å¯ fcitx5

é…ç½®å·²æ›´æ–°ï¼Œé‡å¯ fcitx5 å³å¯ï¼š
```bash
killall fcitx5
fcitx5 &
```

æˆ–è€…é€šè¿‡ç³»ç»Ÿè®¾ç½®é‡å¯è¾“å…¥æ³•æ¡†æ¶ã€‚

---

## Git åŒæ­¥è¯´æ˜

### .gitignore é…ç½®

æœ¬ä»“åº“å·²é…ç½® `.gitignore`ï¼Œæ’é™¤ä»¥ä¸‹å†…å®¹ï¼š

- `build/` - ç¼–è¯‘è¾“å‡ºç›®å½•ï¼ˆå¯é‡æ–°ç”Ÿæˆï¼‰
- `sync/` - åŒæ­¥å¤‡ä»½ç›®å½•
- `*.log` - æ—¥å¿—æ–‡ä»¶
- `lost/` - ä¸¢å¤±æ–‡ä»¶æ¢å¤ç›®å½•
- `*.tar.gz`, `*.zip` - å¤‡ä»½æ–‡ä»¶

### åŒæ­¥çš„å†…å®¹

- âœ… æ‰€æœ‰é…ç½®æ–‡ä»¶ï¼ˆ`.yaml`ï¼‰
- âœ… `lua/` ç›®å½•ï¼ˆLua è„šæœ¬ï¼‰
- âœ… `opencc/` ç›®å½•ï¼ˆç®€ç¹è½¬æ¢ï¼‰
- âœ… `*.userdb/` ç›®å½•ï¼ˆç”¨æˆ·è¯å…¸ï¼Œå·²å¯ç”¨åŒæ­¥ï¼‰

### åŒæ­¥åˆ° GitHub

```bash
cd ~/.local/share/fcitx5/rime

# 1. æ·»åŠ æ‰€æœ‰æ–‡ä»¶
git add .

# 2. æäº¤
git commit -m "Initial commit: Rime è¾“å…¥æ³•é…ç½®ï¼ˆä»… sbzrï¼‰"

# 3. åœ¨ GitHub ä¸Šåˆ›å»ºæ–°ä»“åº“ï¼Œç„¶åæ·»åŠ è¿œç¨‹ä»“åº“
git remote add origin https://github.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“å.git

# 4. æ¨é€åˆ° GitHub
git branch -M main
git push -u origin main
```

### æ³¨æ„äº‹é¡¹

- `build/` ç›®å½•ä¼šè¢«è‡ªåŠ¨ç”Ÿæˆï¼Œä¸éœ€è¦åŒæ­¥
- `*.userdb/` ç›®å½•åŒ…å«ä¸ªäººå­¦ä¹ æ•°æ®ï¼Œå·²å¯ç”¨åŒæ­¥
- ä¿®æ”¹é…ç½®åéœ€è¦è¿è¡Œ `rime_deployer --build` é‡æ–°ç¼–è¯‘

---

## æ³¨æ„äº‹é¡¹

- `build/` ç›®å½•ä¼šè¢«è‡ªåŠ¨ç”Ÿæˆï¼Œä¸éœ€è¦åŒæ­¥
- `*.userdb/` ç›®å½•åŒ…å«ä¸ªäººå­¦ä¹ æ•°æ®ï¼Œå·²å¯ç”¨åŒæ­¥
- ä¿®æ”¹é…ç½®åéœ€è¦è¿è¡Œ `rime_deployer --build` é‡æ–°ç¼–è¯‘
- äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆ`.bin`, `.ldb`ï¼‰æ— æ³•åœ¨ GitHub ä¸ŠæŸ¥çœ‹å·®å¼‚
- å¤šè®¾å¤‡åŒæ—¶ç¼–è¾‘ userdb å¯èƒ½äº§ç”Ÿå†²çª

---

## ç›¸å…³æ–‡ä»¶

- `rebuild.sh` - é‡å»ºè„šæœ¬ï¼ˆåˆ é™¤ build å¹¶é‡æ–°ç¼–è¯‘ï¼‰
- `.gitignore` - Git å¿½ç•¥è§„åˆ™
- `default.custom.yaml` - é»˜è®¤é…ç½®è‡ªå®šä¹‰
- `sbzr.custom.yaml` - å£°ç¬”è‡ªç„¶è‡ªå®šä¹‰é…ç½®
# sbzr